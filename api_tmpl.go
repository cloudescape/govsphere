package main

var headerTmpl = `
// Generated by https://github.com/c4milo/govsphere
// Do not modify
// Copyright (c) 2014, Cloudescape. All rights reserved.

`

var importsTmpl = `
import (
	gowsdl "github.com/c4milo/gowsdl/generator"
)
`

var moTmpl = doTmpl

var doTmpl = `
{{$comment := comment .Description}}
{{$type := makePublic .Name true}}
{{$namespace := .Namespace}}
{{if $comment}} {{$comment}} {{end}}
type {{$type}} struct {
	{{$extends := toGoType .Extends}}
	{{if ne $extends "*ManagedEntity"}}
		{{if ne $extends "*ExtensibleManagedObject"}}
			{{if eq $namespace "mo"}}*ManagedObject{{end}}
		{{end}}{{end}}{{lookUpNamespace $extends $namespace}}
	{{range .Properties}}
		{{$fieldComment := comment .Description}}
		{{$privileges := comment .RequiredPrivileges}}
		{{$fieldType := toGoType .Type}}
		{{if ne $namespace "mo"}}{{if $fieldComment}} {{$fieldComment}} {{end}}{{if $privileges}} {{$privileges}} {{end}}{{end}}
		{{if ne $namespace "mo"}}{{makePublic .Name true}}{{else}}{{replaceReservedWords .Name}}{{end}} {{lookUpNamespace $fieldType $namespace}}{{if eq $type "ManagedObjectReference"}}{{if eq .Name "type"}}` + "`" + `xml:"{{.Name}},attr"` + "`" + `{{else if eq .Name "value"}}` + "`" + `xml:",innerxml"` + "`" + `{{end}}{{else}}` + "`" + `xml:"{{.Name}},omitempty"` + "`" + `{{end}}
	{{end}}
}

{{if eq $namespace "mo"}}
	{{range .Properties}}
		{{$fieldComment := comment .Description}}
		{{$privileges := comment .RequiredPrivileges}}
		{{$fieldType := toGoType .Type}}
		{{$nullValue := toNullType $fieldType}}
		{{$getterName := genGetterName .Name $extends}}
		{{if $fieldComment}} {{$fieldComment}} {{end}}{{if $privileges}} {{$privileges}} {{end}}
		func (mo *{{$type}}) {{$getterName}}() ({{$fieldType}}, error) {
			p, err := mo.currentProperty("{{.Name}}")
			if err != nil {
				return {{$nullValue}}, err
			}
			{{if $fieldType}}
				if p != nil {
					return p.({{$fieldType}}), nil
				}
				return {{$nullValue}}, nil
			{{else}}
				return nil
			{{end}}
		}
	{{end}}
{{end}}


{{range .Methods}}
{{$mcomment := comment .Description}}
{{$returnType := toGoType .ReturnValue.Type}}
{{if $mcomment}} {{$mcomment}} {{end}}
func ({{$namespace}} *{{$type}}) {{makePublic .Name true}}(
{{range .Parameters}} {{if ne .Name "_this"}}{{$ptype := toGoType .Type}} {{replaceReservedWords .Name}} {{lookUpNamespace $ptype $namespace}}, {{end}}{{end}}
) ({{if $returnType}}{{lookUpNamespace $returnType $namespace}},{{end}} error) {

	{{$requestType := makePublic .Name true}}

	request := struct {
		XMLName	xml.Name ` + "`" + `xml:"{{$requestType}}"` + "`" + `
		{{range .Parameters}}{{$ptype := toGoType .Type}}{{if eq .Name "_this"}}This{{else}}{{makePublic .Name true}}{{end}} {{lookUpNamespace $ptype $namespace}} ` + "`" + `xml:"{{.Name}},omitempty"` + "`" + `
		{{end}}
	}{
		{{range .Parameters}}{{if eq .Name "_this"}}This{{else}}{{makePublic .Name true}}{{end}}:{{if eq .Name "_this"}}&ManagedObjectReference{Type: mo.ManagedObject.Type, Value:mo.ManagedObject.Value},{{else}}{{replaceReservedWords .Name}},{{end}}
		{{end}}
	}

	{{if $returnType}}
	response := struct {
		Returnval {{lookUpNamespace $returnType $namespace}} ` + "`" + `xml:"returnval"` + "`" + `
	}{}
	{{end}}

	if session == nil {
		panic("You need to create a vSphereSession first")
	}

	err := session.invoke(request, {{if $returnType}}&response{{else}}nil{{end}})
	if err != nil {
		{{if $returnType}}return {{toNullType $returnType}}, err{{else}}return err{{end}}
	}

	{{if $returnType}}
		return response.Returnval, nil
	{{else}}
		return nil
	{{end}}
}
{{end}}
`

var enumTmpl = `
{{$type := .Name}}
{{$comment := comment .Description}}
{{if $comment}} {{$comment}} {{end}}
type {{$type}} string
const (
	{{range .Constants}}
		{{$constComment := comment .Description}}
		{{if $constComment}} {{$constComment}} {{end}}
		{{makePublic .Name true}}_{{$type}} {{$type}} = "{{.Name}}"
	{{end}}
)
`

var faultTmpl = doTmpl

var registryTmpl = `
var registry map[string]func() interface{}
func init() {
	registry = map[string]func() interface{}{
		{{range .}}
			"{{.Name}}": func() interface{} { return &{{.Name}}{} },
		{{end}}
	}
}
`
